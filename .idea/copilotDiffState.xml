<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="CopilotDiffPersistence">
    <option name="pendingDiffs">
      <map>
        <entry key="$PROJECT_DIR$/src/main/java/com/pifirm/domain/dto/area/AreaDto.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/src/main/java/com/pifirm/domain/dto/area/AreaDto.java" />
              <option name="originalContent" value="package com.pifirm.domain.dto.area;&#10;&#10;import com.pifirm.domain.utils.ExistsValue;&#10;import com.pifirm.domain.utils.UniqueValue;&#10;import com.pifirm.persistence.entity.AreaEntity;&#10;import com.pifirm.persistence.entity.ServicioEntity;&#10;import jakarta.validation.constraints.NotNull;&#10;&#10;import java.math.BigDecimal;&#10;&#10;&#10;public record AreaDto(&#10;         @UniqueValue( fieldName = &quot;nombre&quot;,  entityClass = AreaEntity.class, message = &quot;Ya existe un area con este nombre&quot;)&#10;         String nombre,&#10;         String descripcion,&#10;         @NotNull(message = &quot;El servicio es requerido&quot;)&#10;         @ExistsValue(fieldName = &quot;id&quot;, entityClass = ServicioEntity.class, message = &quot;El servicio no existe&quot;)&#10;         Long servicioId&#10;) {&#10;&#10;}&#10;&#10;" />
              <option name="updatedContent" value="package com.pifirm.domain.dto.area;&#10;&#10;import com.pifirm.domain.repository.ServicioRepository;&#10;import com.pifirm.domain.utils.ExistsValue;&#10;import com.pifirm.domain.utils.UniqueValue;&#10;import com.pifirm.persistence.entity.AreaEntity;&#10;import jakarta.validation.constraints.NotNull;&#10;&#10;&#10;public record AreaDto(&#10;         @UniqueValue( fieldName = &quot;nombre&quot;,  entityClass = AreaEntity.class, message = &quot;Ya existe un area con este nombre&quot;)&#10;         String nombre,&#10;         String descripcion,&#10;         @NotNull(message = &quot;El servicio es requerido&quot;)&#10;         @ExistsValue(repository = ServicioRepository.class, message = &quot;El servicio no existe&quot;)&#10;         Long servicioId&#10;) {&#10;&#10;}&#10;&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/src/main/java/com/pifirm/domain/service/AreaService.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/src/main/java/com/pifirm/domain/service/AreaService.java" />
              <option name="originalContent" value="package com.pifirm.domain.service;&#10;&#10;import com.pifirm.domain.dto.area.AreaDto;&#10;import com.pifirm.domain.dto.area.AreaResDto;&#10;import com.pifirm.domain.exception.GeneralException;&#10;import com.pifirm.domain.repository.AreaRepository;&#10;import com.pifirm.domain.repository.ServicioRepository;&#10;import com.pifirm.persistence.entity.AreaEntity;&#10;import com.pifirm.persistence.entity.ServicioEntity;&#10;import com.pifirm.persistence.mapper.AreaMapper;&#10;import jakarta.transaction.Transactional;&#10;import lombok.AllArgsConstructor;&#10;import org.springframework.data.domain.Page;&#10;import org.springframework.data.domain.Pageable;&#10;import org.springframework.stereotype.Service;&#10;&#10;@Service&#10;@AllArgsConstructor&#10;public class AreaService {&#10;    private final AreaRepository areaRepository;&#10;    private final AreaMapper areaMapper;&#10;    private final ServicioRepository servicioRepository;&#10;&#10;&#10;    @Transactional&#10;    public AreaResDto add(AreaDto dto) {&#10;        AreaEntity entity = areaMapper.toEntity(dto);&#10;        &#10;        // Establecer la relaci贸n con el servicio&#10;        ServicioEntity servicio = servicioRepository.findById(dto.servicioId())&#10;                .orElseThrow(() -&gt; new GeneralException(&quot;servicio-not-found&quot;, &quot;Servicio no encontrado&quot;));&#10;        entity.setServicio(servicio);&#10;        &#10;        AreaEntity saved = areaRepository.save(entity);&#10;        return areaMapper.toDto(saved);&#10;    }&#10;&#10;    @Transactional&#10;    public AreaResDto update(Long id, AreaDto dto) {&#10;        AreaEntity entity = areaRepository.findById(id)&#10;                .orElseThrow(() -&gt; new GeneralException(&quot;Area-not-found&quot;, &quot;Area no encontrado&quot;));&#10;&#10;        if (dto.nombre() != null) entity.setNombre(dto.nombre());&#10;        if (dto.descripcion() != null) entity.setDescripcion(dto.descripcion());&#10;        &#10;        // Actualizar la relaci贸n con el servicio si se proporciona&#10;        if (dto.servicioId() != null) {&#10;            ServicioEntity servicio = servicioRepository.findById(dto.servicioId())&#10;                    .orElseThrow(() -&gt; new GeneralException(&quot;servicio-not-found&quot;, &quot;Servicio no encontrado&quot;));&#10;            entity.setServicio(servicio);&#10;        }&#10;&#10;        AreaEntity updated = areaRepository.save(entity);&#10;        return areaMapper.toDto(updated);&#10;    }&#10;&#10;    @Transactional&#10;    public AreaResDto getById(Long id) {&#10;        AreaEntity entity = areaRepository.findById(id)&#10;                .orElseThrow(() -&gt; new GeneralException(&quot;Area-not-found&quot;, &quot;Area no encontrado&quot;));&#10;        return areaMapper.toDto(entity);&#10;    }&#10;&#10;    @Transactional&#10;    public void delete(Long id) {&#10;        AreaEntity entity = areaRepository.findById(id)&#10;                .orElseThrow(() -&gt; new GeneralException(&quot;Area-not-found&quot;, &quot;Area no encontrado&quot;));&#10;        areaRepository.deleteById(id);&#10;    }&#10;&#10;    @Transactional&#10;    public Page&lt;AreaResDto&gt; all(Pageable pageable) {&#10;        return areaRepository.findAll(pageable).map(areaMapper::toDto);&#10;    }&#10;}&#10;&#10;" />
              <option name="updatedContent" value="package com.pifirm.domain.service;&#10;&#10;import com.pifirm.domain.dto.area.AreaDto;&#10;import com.pifirm.domain.dto.area.AreaResDto;&#10;import com.pifirm.domain.exception.GeneralException;&#10;import com.pifirm.domain.repository.AreaRepository;&#10;import com.pifirm.domain.repository.ServicioRepository;&#10;import com.pifirm.persistence.entity.AreaEntity;&#10;import com.pifirm.persistence.entity.ServicioEntity;&#10;import com.pifirm.persistence.mapper.AreaMapper;&#10;import jakarta.transaction.Transactional;&#10;import lombok.AllArgsConstructor;&#10;import org.springframework.data.domain.Page;&#10;import org.springframework.data.domain.Pageable;&#10;import org.springframework.stereotype.Service;&#10;&#10;@Service&#10;@AllArgsConstructor&#10;public class AreaService {&#10;    private final AreaRepository areaRepository;&#10;    private final AreaMapper areaMapper;&#10;    private final ServicioRepository servicioRepository;&#10;&#10;&#10;    @Transactional&#10;    public AreaResDto add(AreaDto dto) {&#10;        AreaEntity entity = areaMapper.toEntity(dto);&#10;        &#10;        // Establecer la relaci贸n con el servicio&#10;        ServicioEntity servicio = servicioRepository.findById(dto.servicioId())&#10;                .orElseThrow(() -&gt; new GeneralException(&quot;servicio-not-found&quot;, &quot;Servicio no encontrado&quot;));&#10;        entity.setServicio(servicio);&#10;        &#10;        AreaEntity saved = areaRepository.save(entity);&#10;        return areaMapper.toDto(saved);&#10;    }&#10;&#10;    @Transactional&#10;    public AreaResDto update(Long id, AreaDto dto) {&#10;        AreaEntity entity = areaRepository.findById(id)&#10;                .orElseThrow(() -&gt; new GeneralException(&quot;Area-not-found&quot;, &quot;Area no encontrado&quot;));&#10;&#10;        if (dto.nombre() != null) entity.setNombre(dto.nombre());&#10;        if (dto.descripcion() != null) entity.setDescripcion(dto.descripcion());&#10;        &#10;        // Actualizar la relaci贸n con el servicio si se proporciona&#10;        if (dto.servicioId() != null) {&#10;            ServicioEntity servicio = servicioRepository.findById(dto.servicioId())&#10;                    .orElseThrow(() -&gt; new GeneralException(&quot;servicio-not-found&quot;, &quot;Servicio no encontrado&quot;));&#10;            entity.setServicio(servicio);&#10;        }&#10;&#10;        AreaEntity updated = areaRepository.save(entity);&#10;        return areaMapper.toDto(updated);&#10;    }&#10;&#10;    @Transactional&#10;    public AreaResDto getById(Long id) {&#10;        AreaEntity entity = areaRepository.findById(id)&#10;                .orElseThrow(() -&gt; new GeneralException(&quot;Area-not-found&quot;, &quot;Area no encontrado&quot;));&#10;        return areaMapper.toDto(entity);&#10;    }&#10;&#10;    @Transactional&#10;    public void delete(Long id) {&#10;        if (!areaRepository.existsById(id)) {&#10;            throw new GeneralException(&quot;Area-not-found&quot;, &quot;Area no encontrado&quot;);&#10;        }&#10;        areaRepository.deleteById(id);&#10;    }&#10;&#10;    @Transactional&#10;    public Page&lt;AreaResDto&gt; all(Pageable pageable) {&#10;        return areaRepository.findAll(pageable).map(areaMapper::toDto);&#10;    }&#10;}&#10;&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/src/main/java/com/pifirm/persistence/ServicioEntityRepository.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/src/main/java/com/pifirm/persistence/ServicioEntityRepository.java" />
              <option name="updatedContent" value="package com.pifirm.persistence;&#10;&#10;import com.pifirm.domain.repository.ServicioRepository;&#10;import com.pifirm.persistence.crud.CrudServicio;&#10;import com.pifirm.persistence.entity.ServicioEntity;&#10;import org.springframework.data.domain.Page;&#10;import org.springframework.data.domain.Pageable;&#10;import org.springframework.stereotype.Repository;&#10;&#10;import java.util.Optional;&#10;&#10;@Repository&#10;public class ServicioEntityRepository implements ServicioRepository {&#10;&#10;    private final CrudServicio crudServicio;&#10;&#10;    public ServicioEntityRepository(CrudServicio crudServicio) {&#10;        this.crudServicio = crudServicio;&#10;    }&#10;&#10;    @Override&#10;    public ServicioEntity save(ServicioEntity servicioEntity) {&#10;        return this.crudServicio.save(servicioEntity);&#10;    }&#10;&#10;    @Override&#10;    public Optional&lt;ServicioEntity&gt; findById(Long id) {&#10;        return this.crudServicio.findById(id);&#10;    }&#10;&#10;    @Override&#10;    public ServicioEntity update(ServicioEntity servicioEntity) {&#10;        return this.crudServicio.save(servicioEntity);&#10;    }&#10;&#10;    @Override&#10;    public void deleteById(Long id) {&#10;        this.crudServicio.deleteById(id);&#10;    }&#10;&#10;    @Override&#10;    public Page&lt;ServicioEntity&gt; findAll(Pageable pageable) {&#10;        return this.crudServicio.findAll(pageable);&#10;    }&#10;}&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/src/main/java/com/pifirm/persistence/entity/AreaEntity.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/src/main/java/com/pifirm/persistence/entity/AreaEntity.java" />
              <option name="originalContent" value="package com.pifirm.persistence.entity;&#10;&#10;import jakarta.persistence.*;&#10;import jakarta.validation.constraints.NotNull;&#10;import jakarta.validation.constraints.Size;&#10;import lombok.Data;&#10;import org.hibernate.annotations.CreationTimestamp;&#10;import org.hibernate.annotations.UpdateTimestamp;&#10;&#10;import java.math.BigDecimal;&#10;import java.time.Instant;&#10;&#10;@Entity&#10;@Table(name = &quot;area&quot;)&#10;@Data&#10;public class AreaEntity {&#10;    @Id&#10;    @GeneratedValue(strategy = GenerationType.IDENTITY)&#10;    private Long id;&#10;&#10;    @Size(max = 100)&#10;    @NotNull&#10;    @Column(name = &quot;nombre&quot;, nullable = false, length = 100, unique = true)&#10;    private String nombre;&#10;&#10;    @Column(name = &quot;descripcion&quot;, columnDefinition = &quot;TEXT&quot;)&#10;    private String descripcion;&#10;&#10;    @ManyToOne(fetch = FetchType.LAZY)&#10;    @JoinColumn(name = &quot;servicio_id&quot;, nullable = false)&#10;    @NotNull&#10;    private ServicioEntity servicio;&#10;&#10;    @CreationTimestamp&#10;    @Column(name = &quot;created_at&quot;, nullable = false)&#10;    private Instant createdAt;&#10;&#10;    @UpdateTimestamp&#10;    @Column(name = &quot;updated_at&quot;, nullable = false)&#10;    private Instant updatedAt;&#10;&#10;}&#10;&#10;" />
              <option name="updatedContent" value="package com.pifirm.persistence.entity;&#10;&#10;import jakarta.persistence.*;&#10;import jakarta.validation.constraints.NotNull;&#10;import jakarta.validation.constraints.Size;&#10;import lombok.Data;&#10;import org.hibernate.annotations.CreationTimestamp;&#10;import org.hibernate.annotations.UpdateTimestamp;&#10;&#10;import java.time.Instant;&#10;&#10;@Entity&#10;@Table(name = &quot;area&quot;)&#10;@Data&#10;public class AreaEntity {&#10;    @Id&#10;    @GeneratedValue(strategy = GenerationType.IDENTITY)&#10;    private Long id;&#10;&#10;    @Size(max = 100)&#10;    @NotNull&#10;    @Column(name = &quot;nombre&quot;, nullable = false, length = 100, unique = true)&#10;    private String nombre;&#10;&#10;    @Column(name = &quot;descripcion&quot;, columnDefinition = &quot;TEXT&quot;)&#10;    private String descripcion;&#10;&#10;    @ManyToOne(fetch = FetchType.LAZY)&#10;    @JoinColumn(name = &quot;servicio_id&quot;, nullable = false)&#10;    @NotNull&#10;    private ServicioEntity servicio;&#10;&#10;    @CreationTimestamp&#10;    @Column(name = &quot;created_at&quot;, nullable = false)&#10;    private Instant createdAt;&#10;&#10;    @UpdateTimestamp&#10;    @Column(name = &quot;updated_at&quot;, nullable = false)&#10;    private Instant updatedAt;&#10;&#10;}&#10;&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/src/main/java/com/pifirm/persistence/mapper/AreaMapper.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/src/main/java/com/pifirm/persistence/mapper/AreaMapper.java" />
              <option name="originalContent" value="package com.pifirm.persistence.mapper;&#10;&#10;&#10;import com.pifirm.domain.dto.area.AreaDto;&#10;import com.pifirm.domain.dto.area.AreaResDto;&#10;import com.pifirm.persistence.entity.AreaEntity;&#10;import com.pifirm.persistence.entity.ServicioEntity;&#10;import org.mapstruct.Mapper;&#10;import org.mapstruct.Mapping;&#10;&#10;import java.util.List;&#10;&#10;@Mapper(componentModel = &quot;spring&quot;, uses = {ServicioMapper.class})&#10;public interface AreaMapper {&#10;    AreaResDto toDto(AreaEntity entity);&#10;    &#10;    @Mapping(target = &quot;servicio&quot;, ignore = true)&#10;    @Mapping(target = &quot;id&quot;, ignore = true)&#10;    @Mapping(target = &quot;createdAt&quot;, ignore = true)&#10;    @Mapping(target = &quot;updatedAt&quot;, ignore = true)&#10;    AreaEntity toEntity(AreaDto dto);&#10;    &#10;    List&lt;AreaResDto&gt; toDto(Iterable&lt;AreaEntity&gt; entities);&#10;    &#10;    default ServicioEntity mapServicioId(Long servicioId) {&#10;        if (servicioId == null) {&#10;            return null;&#10;        }&#10;        ServicioEntity servicio = new ServicioEntity();&#10;        servicio.setId(servicioId);&#10;        return servicio;&#10;    }&#10;}&#10;&#10;" />
              <option name="updatedContent" value="package com.pifirm.persistence.mapper;&#10;&#10;&#10;import com.pifirm.domain.dto.area.AreaDto;&#10;import com.pifirm.domain.dto.area.AreaResDto;&#10;import com.pifirm.persistence.entity.AreaEntity;&#10;import com.pifirm.persistence.entity.ServicioEntity;&#10;import org.mapstruct.Mapper;&#10;import org.mapstruct.Mapping;&#10;&#10;import java.util.List;&#10;&#10;@Mapper(componentModel = &quot;spring&quot;, uses = {ServicioMapper.class})&#10;public interface AreaMapper {&#10;    AreaResDto toDto(AreaEntity entity);&#10;    &#10;    @Mapping(target = &quot;servicio&quot;, ignore = true)&#10;    @Mapping(target = &quot;id&quot;, ignore = true)&#10;    @Mapping(target = &quot;createdAt&quot;, ignore = true)&#10;    @Mapping(target = &quot;updatedAt&quot;, ignore = true)&#10;    AreaEntity toEntity(AreaDto dto);&#10;    &#10;    List&lt;AreaResDto&gt; toDto(Iterable&lt;AreaEntity&gt; entities);&#10;}&#10;&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
      </map>
    </option>
  </component>
</project>